<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat Server Test</title>
<style>
body { font-family: system-ui, -apple-system, Arial; padding: 1rem; }
#messages { border: 1px solid #ddd; padding: 1rem; height: 300px; overflow:auto; }
.message { margin-bottom: .5rem; }
.input { margin-top: .5rem; }
</style>
</head>
<body>
<h1>Chat Server Test</h1>
<div id="messages">로딩 중...</div>
<div class="input">
  <input id="text" placeholder="메시지 입력" style="width:70%" />
  <button id="send">전송</button>
</div>
<script>
async function load() {
  try {
    const r = await fetch('/api/messages');
    const data = await r.json();
    const box = document.getElementById('messages');
    box.innerHTML = '';
    data.forEach(m => {
      const div = document.createElement('div');
      div.className = 'message';
      div.textContent = `[${new Date(m.timestamp).toLocaleString()}] ${m.user}: ${m.text}`;
      box.appendChild(div);
    });
  } catch (e) {
    document.getElementById('messages').textContent = '로드 실패: ' + e;
  }
}

document.getElementById('send').addEventListener('click', async () => {
  const text = document.getElementById('text').value;
  if (!text) return alert('메시지 입력');
  try {
    const r = await fetch('/api/messages', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({text, user: 'web'})});
    if (!r.ok) throw new Error('응답 오류 '+r.status);
    document.getElementById('text').value = '';
    await load();
  } catch(e) { alert('전송 실패: '+e); }
});

load();
setInterval(load, 5000);
</script>
</body>
</html>